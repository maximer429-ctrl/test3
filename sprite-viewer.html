<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troup'O Invaders - Sprite Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #444;
        }

        h1 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 14px;
        }

        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: bold;
            color: #aaa;
        }

        .control-group select,
        .control-group input {
            padding: 5px 10px;
            background: #2a2a2a;
            color: #e0e0e0;
            border: 1px solid #444;
            border-radius: 4px;
            font-family: inherit;
        }

        .control-group button {
            padding: 5px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.3s;
        }

        .control-group button:hover {
            background: #45a049;
        }

        .sprite-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .sprite-card {
            background: #2a2a2a;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .sprite-card:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }

        .sprite-container {
            width: 100%;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .sprite-container.bg-dark {
            background: #1a1a1a;
        }

        .sprite-container.bg-light {
            background: #e0e0e0;
        }

        .sprite-container.bg-transparent {
            background: 
                linear-gradient(45deg, #555 25%, transparent 25%),
                linear-gradient(-45deg, #555 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #555 75%),
                linear-gradient(-45deg, transparent 75%, #555 75%);
            background-size: 10px 10px;
            background-position: 0 0, 0 5px, 5px -5px, -5px 0px;
        }

        .sprite-container canvas {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .sprite-name {
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .sprite-info {
            font-size: 12px;
            color: #888;
        }

        .sprite-info div {
            margin: 2px 0;
        }

        .error {
            color: #f44336;
            text-align: center;
            padding: 20px;
            background: #2a2a2a;
            border: 2px solid #f44336;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 600px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #4CAF50;
        }

        .stats {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            max-width: 800px;
            margin: 0 auto 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .stat-item {
            padding: 10px;
            background: #1a1a1a;
            border-radius: 4px;
        }

        .stat-value {
            font-size: 24px;
            color: #4CAF50;
            font-weight: bold;
        }

        .stat-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <header>
        <h1>üêë Troup'O Invaders - Sprite Viewer ü¶ô</h1>
        <div class="subtitle">Sprite Development and Preview Tool</div>
    </header>

    <div class="controls">
        <div class="control-group">
            <label for="zoom">Zoom:</label>
            <select id="zoom">
                <option value="1">1x</option>
                <option value="2" selected>2x</option>
                <option value="3">3x</option>
                <option value="4">4x</option>
                <option value="5">5x</option>
                <option value="6">6x</option>
                <option value="8">8x</option>
            </select>
        </div>

        <div class="control-group">
            <label for="background">Background:</label>
            <select id="background">
                <option value="dark" selected>Dark</option>
                <option value="light">Light</option>
                <option value="transparent">Transparent</option>
            </select>
        </div>

        <div class="control-group">
            <button id="refresh">üîÑ Refresh</button>
        </div>
    </div>

    <div class="stats" id="stats" style="display: none;">
        <div style="font-weight: bold; margin-bottom: 10px; color: #4CAF50;">Sprite Atlas Statistics</div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="totalSprites">0</div>
                <div class="stat-label">Total Sprites</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalEnemies">0</div>
                <div class="stat-label">Enemy Types</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalWeapons">0</div>
                <div class="stat-label">Weapon Sprites</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalEffects">0</div>
                <div class="stat-label">Effect Sprites</div>
            </div>
        </div>
    </div>

    <div id="loading" class="loading">Loading sprites...</div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="spriteGrid" class="sprite-grid"></div>

    <script>
        let spriteAtlas = null;
        let loadedImages = {};

        async function loadSpriteAtlas() {
            try {
                const response = await fetch('assets/sprite-atlas.json');
                if (!response.ok) {
                    throw new Error(`Failed to load sprite atlas: ${response.status}`);
                }
                spriteAtlas = await response.json();
                return spriteAtlas;
            } catch (error) {
                console.error('Error loading sprite atlas:', error);
                throw error;
            }
        }

        async function loadImage(path) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error(`Failed to load image: ${path}`));
                img.src = path;
            });
        }

        function drawSpriteToCanvas(image, width, height, zoom) {
            const canvas = document.createElement('canvas');
            canvas.width = width * zoom;
            canvas.height = height * zoom;
            const ctx = canvas.getContext('2d');
            
            ctx.imageSmoothingEnabled = false;
            ctx.drawImage(image, 0, 0, width, height, 0, 0, width * zoom, height * zoom);
            
            return canvas;
        }

        function createSpriteCard(name, spriteData, zoom, background) {
            const card = document.createElement('div');
            card.className = 'sprite-card';
            
            const container = document.createElement('div');
            container.className = `sprite-container bg-${background}`;
            
            const nameDiv = document.createElement('div');
            nameDiv.className = 'sprite-name';
            nameDiv.textContent = name;
            
            const infoDiv = document.createElement('div');
            infoDiv.className = 'sprite-info';
            
            const dimensions = document.createElement('div');
            dimensions.textContent = `${spriteData.width}x${spriteData.height}px`;
            
            const filePath = document.createElement('div');
            filePath.textContent = spriteData.file;
            
            infoDiv.appendChild(dimensions);
            
            if (spriteData.points !== undefined) {
                const points = document.createElement('div');
                points.textContent = `‚≠ê ${spriteData.points} points`;
                points.style.color = '#FFD700';
                infoDiv.appendChild(points);
            }
            
            infoDiv.appendChild(filePath);
            
            card.appendChild(container);
            card.appendChild(nameDiv);
            card.appendChild(infoDiv);
            
            return { card, container };
        }

        async function renderSprites() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const grid = document.getElementById('spriteGrid');
            const stats = document.getElementById('stats');
            
            loading.style.display = 'block';
            error.style.display = 'none';
            grid.innerHTML = '';
            stats.style.display = 'none';
            
            const zoom = parseInt(document.getElementById('zoom').value);
            const background = document.getElementById('background').value;
            
            try {
                if (!spriteAtlas) {
                    spriteAtlas = await loadSpriteAtlas();
                }
                
                const basePath = spriteAtlas.meta.image || 'sprites/';
                const sprites = spriteAtlas.sprites;
                
                // Calculate statistics
                let enemyCount = 0;
                let weaponCount = 0;
                let effectCount = 0;
                
                for (const [name, data] of Object.entries(sprites)) {
                    if (name.includes('enemy') || name.includes('sheep') || name.includes('goat') || name.includes('alpaca') || name === 'ufo') {
                        enemyCount++;
                    } else if (name.includes('bullet')) {
                        weaponCount++;
                    } else if (name.includes('explosion') || name.includes('particle')) {
                        effectCount++;
                    }
                }
                
                document.getElementById('totalSprites').textContent = Object.keys(sprites).length;
                document.getElementById('totalEnemies').textContent = enemyCount;
                document.getElementById('totalWeapons').textContent = weaponCount;
                document.getElementById('totalEffects').textContent = effectCount;
                stats.style.display = 'block';
                
                // Load and render all sprites
                for (const [name, data] of Object.entries(sprites)) {
                    const imagePath = `assets/${basePath}${data.file}`;
                    
                    // Load image if not cached
                    if (!loadedImages[imagePath]) {
                        loadedImages[imagePath] = await loadImage(imagePath);
                    }
                    
                    const image = loadedImages[imagePath];
                    const { card, container } = createSpriteCard(name, data, zoom, background);
                    
                    const canvas = drawSpriteToCanvas(image, data.width, data.height, zoom);
                    container.appendChild(canvas);
                    
                    grid.appendChild(card);
                }
                
                loading.style.display = 'none';
                
            } catch (err) {
                console.error('Error rendering sprites:', err);
                loading.style.display = 'none';
                error.style.display = 'block';
                error.textContent = `Error: ${err.message}`;
            }
        }

        // Event listeners
        document.getElementById('zoom').addEventListener('change', renderSprites);
        document.getElementById('background').addEventListener('change', () => {
            const background = document.getElementById('background').value;
            document.querySelectorAll('.sprite-container').forEach(container => {
                container.className = `sprite-container bg-${background}`;
            });
        });
        document.getElementById('refresh').addEventListener('click', () => {
            loadedImages = {};
            spriteAtlas = null;
            renderSprites();
        });

        // Initial load
        renderSprites();
    </script>
</body>
</html>
